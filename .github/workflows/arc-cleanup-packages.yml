name: Cleanup GitHub Packages

on:
  workflow_dispatch:
    inputs:
      package_name_filter:
        description: 'Package name filter (supports * and ?)'
        required: true
        default: 'ThunderPropagator.BuildingBlocks*'

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run package cleanup script
        shell: pwsh
        env:
          # Make the PAT available as GH_PAT so your script can pick it up
          GH_PAT: ${{ secrets.GH_TOKEN }}
        run: |
          $ErrorActionPreference = "Stop"

          # We only pass the filter; username is inferred from git remote,
          # token is picked up from GH_PAT env by your script.
          ./Delete-GitHubPackages.ps1 `
            -PackageNameFilter '${{ github.event.inputs.package_name_filter }}'
